(function(h){h.facebox=function(n,m){h.facebox.loading();h.facebox.content_klass=m;if(n.ajax){i(n.ajax)}else{if(n.image){d(n.image)}else{if(n.images){j(n.images,n.initial)}else{if(n.div){k(n.div)}else{if(h.isFunction(n)){n.call(h)}else{h.facebox.reveal(n)}}}}}};h.extend(h.facebox,{settings:{opacity:0,overlay:true,modal:false,imageTypes:["png","jpg","jpeg","gif"]},html:function(){return'<div id="facebox" style="display:none;">   <div class="popup">     <table>       <tbody>         <tr>           <td class="tl"/><td class="b"/><td class="tr"/>         </tr>         <tr>           <td class="b"/>           <td class="body">             <div class="content">             </div>             <div class="footer">               <a href="#" class="close"></a>            </div>           </td>           <td class="b"/>         </tr>         <tr>           <td class="bl"/><td class="b"/><td class="br"/>         </tr>       </tbody>     </table>   </div> </div>'},loading:function(){l();if(h(".loading",h("#facebox"))[0]){return true}f();h.facebox.wait();if(!h.facebox.settings.modal){h(document).bind("keydown.facebox",function(m){if(m.keyCode==27){h.facebox.close()}})}h(document).trigger("loading.facebox")},wait:function(){var m=h("#facebox");h(".content",m).empty();h(".body",m).children().hide().end().append('<div class="loading"></div>');h.facebox.centralize();m.show();h(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},centralize:function(){h("#facebox").css({top:h(window).scrollTop()+(h(window).height()/10),left:h(window).width()/2-(h("#facebox table").width()/2)})},reveal:function(n){h(document).trigger("beforeReveal.facebox");var m=h("#facebox");h(".content",m).addClass(h.facebox.content_klass||"");h(".content",m).append(n);h(".loading",m).remove();h(".body",m).children().fadeIn("normal");m.css("left",h(window).width()/2-(h("#facebox table").width()/2));h(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},close:function(){h(document).trigger("close.facebox");return false}});h.fn.facebox=function(m){if(m){h.extend(h.facebox.settings,m)}if(!h.facebox.settings.noAutoload){l()}return this.bind("click.facebox",function(){h.facebox.loading();var n=this.rel.match(/facebox\[?\.(\w+)\]?/);h.facebox.content_klass=n?n[1]:"";k(this.href);return false})};function l(){if(h.facebox.settings.inited){return}else{h.facebox.settings.inited=true}h(document).trigger("init.facebox");e();var m=h.facebox.settings.imageTypes.join("|");h.facebox.settings.imageTypesRegexp=new RegExp(".("+m+")$","i");h("body").append(h.facebox.html());if(!h.facebox.settings.noAutoload){a()}h("#facebox .close").click(h.facebox.close)}function a(){h("#facebox").find(".b:first, .loading, .close , .bl, .br, .tl, .tr").each(function(){var m=new Image();m.src=h(this).css("background-image").replace(/url\((.+)\)/,"$1")})}function e(){var m=h.facebox.settings;m.imageTypes=m.image_types||m.imageTypes;m.faceboxHtml=m.facebox_html||m.faceboxHtml}function k(m){if(m.match(/#/)){var n=window.location.href.split("#")[0];var o=m.replace(n,"");h.facebox.reveal(h(o).show().replaceWith("<div id='facebox_moved'></div>"),h.facebox.content_klass)}else{if(m.match(h.facebox.settings.imageTypesRegexp)){d(m)}else{i(m)}}}function d(m){g(m)}function j(q,o){var n=h.inArray(o||0,q);if(n==-1){n=0}h("#facebox div.footer").append(h('<div class="navigation"><a class="prev"/><div class="counter"></div><a class="next"/></div>'));var m=h("#facebox .navigation");h(document).bind("afterClose.facebox",function(){m.remove()});function p(r){n=(n+r+q.length)%q.length;g(q[n]);m.find(".counter").html(n+1+" / "+q.length)}p(0);h(".prev",m).click(function(){p(-1)});h(".next",m).click(function(){p(1)});h(document).bind("keydown.facebox",function(r){if(r.keyCode==39){p(1)}if(r.keyCode==37){p(-1)}})}function g(m){h("#facebox .content").empty();h.facebox.loading();var n=new Image();n.onload=function(){h.facebox.reveal('<div class="image"><img src="'+n.src+'" /></div>',h.facebox.content_klass)};n.src=m}function i(m){h.get(m,function(n){h.facebox.reveal(n)})}function c(){return h.facebox.settings.overlay==false||h.facebox.settings.opacity===null}function f(){if(c()){return}if(h("#facebox_overlay").length==0){h("body").append('<div id="facebox_overlay" class="facebox_hide"></div>')}h("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity",h.facebox.settings.opacity).fadeIn(200);if(!h.facebox.settings.modal){h("#facebox_overlay").click(function(){h(document).trigger("close.facebox")})}return false}function b(){if(c()){return}h("#facebox_overlay").fadeOut(200,function(){h("#facebox_overlay").removeClass("facebox_overlayBG").addClass("facebox_hide").remove()});return false}h(document).bind("close.facebox",function(){h(document).unbind("keydown.facebox");h("#facebox").fadeOut(function(){if(h("#facebox_moved").length==0){h("#facebox .content").removeClass().addClass("content")}else{h("#facebox_moved").replaceWith(h("#facebox .content").children().hide())}b();h("#facebox .loading").remove()});h(document).trigger("afterClose.facebox")})})(jQuery);