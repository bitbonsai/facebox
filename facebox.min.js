(function(h){h.facebox=function(n,m){h.facebox.loading();if(n.ajax){i(n.ajax,m)}else{if(n.image){d(n.image,m)}else{if(n.images){j(n.images,m,n.initial)}else{if(n.div){k(n.div,m)}else{if(h.isFunction(n)){n.call(h)}else{h.facebox.reveal(n,m)}}}}}};h.extend(h.facebox,{settings:{opacity:0,overlay:true,modal:false,imageTypes:["png","jpg","jpeg","gif"]},html:function(){return'<div id="facebox" style="display:none;">   <div class="popup">     <table>       <tbody>         <tr>           <td class="tl"/><td class="b"/><td class="tr"/>         </tr>         <tr>           <td class="b"/>           <td class="body">             <div class="content">             </div>             <div class="footer">               <a href="#" class="close"></a>            </div>           </td>           <td class="b"/>         </tr>         <tr>           <td class="bl"/><td class="b"/><td class="br"/>         </tr>       </tbody>     </table>   </div> </div>'},loading:function(){l();var m=h("#facebox");if(m(".loading",m).length==1){return true}f();h.facebox.wait();if(!h.facebox.settings.modal){h(document).bind("keydown.facebox",function(n){if(n.keyCode==27){h.facebox.close()}return true})}h(document).trigger("loading.facebox")},wait:function(){var m=h("#facebox");h(".content",m).empty();h(".body",m).children().hide().end().append('<div class="loading"></div>');h.facebox.centralize();m.show();h(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},centralize:function(){h("#facebox").css({top:h(window).scrollTop()+(h(window).height()/10),left:h(window).width()/2-(h("#facebox table").width()/2)})},reveal:function(o,m){h(document).trigger("beforeReveal.facebox");var n=h("#facebox");if(m){h(".content",n).addClass(m)}h(".content",n).append(o);h(".loading",n).remove();h(".body",n).children().fadeIn("normal");n.css("left",h(window).width()/2-(h("#facebox table").width()/2));h(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},close:function(){h(document).trigger("close.facebox");return false}});h.fn.facebox=function(m){if(m){h.extend(h.facebox.settings,m)}if(!h.facebox.settings.noAutoload){l()}return this.bind("click.facebox",function(){h.facebox.loading();var n=this.rel.match(/facebox\[?\.(\w+)\]?/);if(n){n=n[1]}k(this.href,n);return false})};function l(){if(h.facebox.settings.inited){return}else{h.facebox.settings.inited=true}h(document).trigger("init.facebox");e();var m=h.facebox.settings.imageTypes.join("|");h.facebox.settings.imageTypesRegexp=new RegExp(".("+m+")$","i");h("body").append(h.facebox.html());if(!h.facebox.settings.noAutoload){a()}h("#facebox .close").click(h.facebox.close)}function a(){h("#facebox").find(".b:first, .loading, .close , .bl, .br, .tl, .tr").each(function(){var m=new Image();m.src=h(this).css("background-image").replace(/url\((.+)\)/,"$1")})}function e(){var m=h.facebox.settings;m.imageTypes=m.image_types||m.imageTypes;m.faceboxHtml=m.facebox_html||m.faceboxHtml}function k(n,m){if(n.match(/#/)){var o=window.location.href.split("#")[0];var p=n.replace(o,"");h.facebox.reveal(h(p).show().replaceWith("<div id='facebox_moved'></div>"),m)}else{if(n.match(h.facebox.settings.imageTypesRegexp)){d(n,m)}else{i(n,m)}}}function d(n,m){g(n,m)}function j(r,o,p){var n=h.inArray(p||0,r);if(n==-1){n=0}h("#facebox div.footer").append(h('<div class="navigation"><a class="prev"/><div class="counter"></div><a class="next"/></div>'));var m=h("#facebox .navigation");h(document).bind("afterClose.facebox",function(){m.remove()});function q(s){n=(n+s+r.length)%r.length;g(r[n],o);m.find(".counter").html(n+1+" / "+r.length)}q(0);h(".prev",m).click(function(){q(-1)});h(".next",m).click(function(){q(1)});h(document).bind("keydown.facebox",function(s){if(s.keyCode==39){q(1)}if(s.keyCode==37){q(-1)}})}function g(n,m){h("#facebox .content").empty();h.facebox.loading();var o=new Image();o.onload=function(){h.facebox.reveal('<div class="image"><img src="'+o.src+'" /></div>',m)};o.src=n}function i(n,m){h.get(n,function(o){h.facebox.reveal(o,m)})}function c(){return h.facebox.settings.overlay==false||h.facebox.settings.opacity===null}function f(){if(c()){return}if(h("#facebox_overlay").length==0){h("body").append('<div id="facebox_overlay" class="facebox_hide"></div>')}h("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity",h.facebox.settings.opacity).fadeIn(200);if(!h.facebox.settings.modal){h("#facebox_overlay").click(function(){h(document).trigger("close.facebox")})}return false}function b(){if(c()){return}h("#facebox_overlay").fadeOut(200,function(){h("#facebox_overlay").removeClass("facebox_overlayBG").addClass("facebox_hide").remove()});return false}h(document).bind("close.facebox",function(){h(document).unbind("keydown.facebox");h("#facebox").fadeOut(function(){if(h("#facebox_moved").length==0){h("#facebox .content").removeClass().addClass("content")}else{h("#facebox_moved").replaceWith(h("#facebox .content").children().hide())}b();h("#facebox .loading").remove()});h(document).trigger("afterClose.facebox")})})(jQuery);