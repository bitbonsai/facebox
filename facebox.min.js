(function(h){h.facebox=function(o,n){h.facebox.loading();if(o.ajax){i(o.ajax,n)}else{if(o.image){d(o.image,n)}else{if(o.div){l(o.div,n)}else{if(h.isFunction(o)){o.call(h)}else{h.facebox.reveal(o,n)}}}}};h.extend(h.facebox,{settings:{opacity:0,overlay:true,imageTypes:["png","jpg","jpeg","gif"]},html:function(){return'<div id="facebox" style="display:none;">   <div class="popup">     <table>       <tbody>         <tr>           <td class="tl"/><td class="b"/><td class="tr"/>         </tr>         <tr>           <td class="b"/>           <td class="body">             <div class="content">             </div>             <div class="footer">               <a href="#" class="close"></a>            </div>           </td>           <td class="b"/>         </tr>         <tr>           <td class="bl"/><td class="b"/><td class="br"/>         </tr>       </tbody>     </table>   </div> </div>'},loading:function(){m();var n=h("#facebox");if(n.find(".loading").length==1){return true}g();h.facebox.wait();h(document).bind("keydown.facebox",function(o){if(o.keyCode==27){h.facebox.close()}return true});h(document).trigger("loading.facebox")},wait:function(){var n=h("#facebox");n.find(".content").empty();n.find(".body").children().hide().end().append('<div class="loading"></div>');n.css({top:j()[1]+(k()/10),left:h(window).width()/2-205}).show()},reveal:function(p,n){h(document).trigger("beforeReveal.facebox");var o=h("#facebox");if(n){h("#facebox .content").addClass(n)}o.find(".content").append(p);o.find(".loading").remove();o.find(".body").children().fadeIn("normal");o.css("left",h(window).width()/2-(h("#facebox table").width()/2));h(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},close:function(){h(document).trigger("close.facebox");return false}});h.fn.facebox=function(n){f(n);if(!n.noAutoload){m()}return this.bind("click.facebox",function(){h.facebox.loading();var o=this.rel.match(/facebox\[?\.(\w+)\]?/);if(o){o=o[1]}l(this.href,o);return false})};function f(n){h.extend(h.facebox.settings,n)}function m(){if(h.facebox.settings.inited){return}else{h.facebox.settings.inited=true}h(document).trigger("init.facebox");e();var n=h.facebox.settings.imageTypes.join("|");h.facebox.settings.imageTypesRegexp=new RegExp(".("+n+")$","i");h("body").append(h.facebox.html());if(!h.facebox.settings.noAutoload){a()}h("#facebox .close").click(h.facebox.close)}function a(){h("#facebox").find(".b:first, .loading, .close , .bl, .br, .tl, .tr").each(function(){preload.push(new Image());preload.slice(-1).src=h(this).css("background-image").replace(/url\((.+)\)/,"$1")})}function j(){var o,n;if(self.pageYOffset){n=self.pageYOffset;o=self.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){n=document.documentElement.scrollTop;o=document.documentElement.scrollLeft}else{if(document.body){n=document.body.scrollTop;o=document.body.scrollLeft}}}return new Array(o,n)}function k(){var n;if(self.innerHeight){n=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){n=document.documentElement.clientHeight}else{if(document.body){n=document.body.clientHeight}}}return n}function e(){var n=h.facebox.settings;n.imageTypes=n.image_types||n.imageTypes;n.faceboxHtml=n.facebox_html||n.faceboxHtml}function l(o,n){if(o.match(/#/)){var p=window.location.href.split("#")[0];var q=o.replace(p,"");h.facebox.reveal(h(q).show().replaceWith("<div id='facebox_moved'></div>"),n)}else{if(o.match(h.facebox.settings.imageTypesRegexp)){d(o,n)}else{i(o,n)}}}function d(o,n){var p=new Image();p.onload=function(){h.facebox.reveal('<div class="image"><img src="'+p.src+'" /></div>',n)};p.src=o}function i(o,n){h.get(o,function(p){h.facebox.reveal(p,n)})}function c(){return h.facebox.settings.overlay==false||h.facebox.settings.opacity===null}function g(){if(c()){return}if(h("#facebox_overlay").length==0){h("body").append('<div id="facebox_overlay" class="facebox_hide"></div>')}h("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity",h.facebox.settings.opacity).click(function(){h(document).trigger("close.facebox")}).fadeIn(200);return false}function b(){if(c()){return}h("#facebox_overlay").fadeOut(200,function(){h("#facebox_overlay").removeClass("facebox_overlayBG").addClass("facebox_hide").remove()});return false}h(document).bind("close.facebox",function(){h(document).unbind("keydown.facebox");h("#facebox").fadeOut(function(){if(h("#facebox_moved").length==0){h("#facebox .content").removeClass().addClass("content")}else{h("#facebox_moved").replaceWith(h("#facebox .content").children().hide())}b();h("#facebox .loading").remove()});h(document).trigger("afterClose.facebox")})})(jQuery);