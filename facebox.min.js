(function(h){h.facebox=function(p,o){h.facebox.loading();if(p.ajax){i(p.ajax,o)}else{if(p.image){d(p.image,o)}else{if(p.images){k(p.images,o,p.initial)}else{if(p.div){m(p.div,o)}else{if(h.isFunction(p)){p.call(h)}else{h.facebox.reveal(p,o)}}}}}};h.extend(h.facebox,{settings:{opacity:0,overlay:true,modal:false,imageTypes:["png","jpg","jpeg","gif"]},html:function(){return'<div id="facebox" style="display:none;">   <div class="popup">     <table>       <tbody>         <tr>           <td class="tl"/><td class="b"/><td class="tr"/>         </tr>         <tr>           <td class="b"/>           <td class="body">             <div class="content">             </div>             <div class="footer">               <a href="#" class="close"></a>            </div>           </td>           <td class="b"/>         </tr>         <tr>           <td class="bl"/><td class="b"/><td class="br"/>         </tr>       </tbody>     </table>   </div> </div>'},loading:function(){n();var o=h("#facebox");if(o.find(".loading").length==1){return true}f();h.facebox.wait();if(!h.facebox.settings.modal){h(document).bind("keydown.facebox",function(p){if(p.keyCode==27){h.facebox.close()}return true})}h(document).trigger("loading.facebox")},wait:function(){var o=h("#facebox");o.find(".content").empty();o.find(".body").children().hide().end().append('<div class="loading"></div>');h.facebox.centralize();o.show();h(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},centralize:function(){h("#facebox").css({top:j()[1]+(l()/10),left:h(window).width()/2-(h("#facebox table").width()/2)})},reveal:function(q,o){h(document).trigger("beforeReveal.facebox");var p=h("#facebox");if(o){h("#facebox .content").addClass(o)}p.find(".content").append(q);p.find(".loading").remove();p.find(".body").children().fadeIn("normal");p.css("left",h(window).width()/2-(h("#facebox table").width()/2));h(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},close:function(){h(document).trigger("close.facebox");return false}});h.fn.facebox=function(o){if(o){h.extend(h.facebox.settings,o)}if(!h.facebox.settings){n()}return this.bind("click.facebox",function(){h.facebox.loading();var p=this.rel.match(/facebox\[?\.(\w+)\]?/);if(p){p=p[1]}m(this.href,p);return false})};function n(){if(h.facebox.settings.inited){return}else{h.facebox.settings.inited=true}h(document).trigger("init.facebox");e();var o=h.facebox.settings.imageTypes.join("|");h.facebox.settings.imageTypesRegexp=new RegExp(".("+o+")$","i");h("body").append(h.facebox.html());if(!h.facebox.settings.noAutoload){a()}h("#facebox .close").click(h.facebox.close)}function a(){h("#facebox").find(".b:first, .loading, .close , .bl, .br, .tl, .tr").each(function(){var o=new Image();o.src=h(this).css("background-image").replace(/url\((.+)\)/,"$1")})}function j(){var p,o;if(self.pageYOffset){o=self.pageYOffset;p=self.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){o=document.documentElement.scrollTop;p=document.documentElement.scrollLeft}else{if(document.body){o=document.body.scrollTop;p=document.body.scrollLeft}}}return new Array(p,o)}function l(){var o;if(self.innerHeight){o=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){o=document.documentElement.clientHeight}else{if(document.body){o=document.body.clientHeight}}}return o}function e(){var o=h.facebox.settings;o.imageTypes=o.image_types||o.imageTypes;o.faceboxHtml=o.facebox_html||o.faceboxHtml}function m(p,o){if(p.match(/#/)){var q=window.location.href.split("#")[0];var r=p.replace(q,"");h.facebox.reveal(h(r).show().replaceWith("<div id='facebox_moved'></div>"),o)}else{if(p.match(h.facebox.settings.imageTypesRegexp)){d(p,o)}else{i(p,o)}}}function d(p,o){g(p,o)}function k(t,q,r){var p=h.inArray(r||0,t);if(p==-1){p=0}h("#facebox div.footer").append(h('<div class="navigation"><a class="prev"/><div class="counter"></div><a class="next"/></div>'));var o=h("#facebox .navigation");h(document).bind("afterClose.facebox",function(){o.remove()});function s(u){p=(p+u+t.length)%t.length;g(t[p],q);o.find(".counter").html(p+1+" / "+t.length)}s(0);h(".prev",o).click(function(){s(-1)});h(".next",o).click(function(){s(1)});h(document).bind("keydown.facebox",function(u){if(u.keyCode==39){s(1)}if(u.keyCode==37){s(-1)}})}function g(p,o){h("#facebox .content").empty();h.facebox.loading();var q=new Image();q.onload=function(){h.facebox.reveal('<div class="image"><img src="'+q.src+'" /></div>',o)};q.src=p}function i(p,o){h.get(p,function(q){h.facebox.reveal(q,o)})}function c(){return h.facebox.settings.overlay==false||h.facebox.settings.opacity===null}function f(){if(c()){return}if(h("#facebox_overlay").length==0){h("body").append('<div id="facebox_overlay" class="facebox_hide"></div>')}h("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity",h.facebox.settings.opacity).fadeIn(200);if(!h.facebox.settings.modal){h("#facebox_overlay").click(function(){h(document).trigger("close.facebox")})}return false}function b(){if(c()){return}h("#facebox_overlay").fadeOut(200,function(){h("#facebox_overlay").removeClass("facebox_overlayBG").addClass("facebox_hide").remove()});return false}h(document).bind("close.facebox",function(){h(document).unbind("keydown.facebox");h("#facebox").fadeOut(function(){if(h("#facebox_moved").length==0){h("#facebox .content").removeClass().addClass("content")}else{h("#facebox_moved").replaceWith(h("#facebox .content").children().hide())}b();h("#facebox .loading").remove()});h(document).trigger("afterClose.facebox")})})(jQuery);