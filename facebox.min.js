(function(g){g.facebox=function(n,m){g.facebox.loading();if(n.ajax){h(n.ajax,m)}else{if(n.image){d(n.image,m)}else{if(n.div){k(n.div,m)}else{if(g.isFunction(n)){n.call(g)}else{g.facebox.reveal(n,m)}}}}};g.extend(g.facebox,{settings:{opacity:0,overlay:true,imageTypes:["png","jpg","jpeg","gif"]},html:function(){return'<div id="facebox" style="display:none;">   <div class="popup">     <table>       <tbody>         <tr>           <td class="tl"/><td class="b"/><td class="tr"/>         </tr>         <tr>           <td class="b"/>           <td class="body">             <div class="content">             </div>             <div class="footer">               <a href="#" class="close"></a>            </div>           </td>           <td class="b"/>         </tr>         <tr>           <td class="bl"/><td class="b"/><td class="br"/>         </tr>       </tbody>     </table>   </div> </div>'},loading:function(){l();var m=g("#facebox");if(m.find(".loading").length==1){return true}f();g.facebox.wait();g(document).bind("keydown.facebox",function(n){if(n.keyCode==27){g.facebox.close()}return true});g(document).trigger("loading.facebox")},wait:function(){var m=g("#facebox");m.find(".content").empty();m.find(".body").children().hide().end().append('<div class="loading"></div>');m.css({top:i()[1]+(j()/10),left:g(window).width()/2-205}).show()},reveal:function(o,m){g(document).trigger("beforeReveal.facebox");var n=g("#facebox");if(m){g("#facebox .content").addClass(m)}n.find(".content").append(o);n.find(".loading").remove();n.find(".body").children().fadeIn("normal");n.css("left",g(window).width()/2-(g("#facebox table").width()/2));g(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},close:function(){g(document).trigger("close.facebox");return false}});g.fn.facebox=function(m){if(m){g.extend(g.facebox.settings,m)}if(!g.facebox.settings){l()}return this.bind("click.facebox",function(){g.facebox.loading();var n=this.rel.match(/facebox\[?\.(\w+)\]?/);if(n){n=n[1]}k(this.href,n);return false})};function l(){if(g.facebox.settings.inited){return}else{g.facebox.settings.inited=true}g(document).trigger("init.facebox");e();var m=g.facebox.settings.imageTypes.join("|");g.facebox.settings.imageTypesRegexp=new RegExp(".("+m+")$","i");g("body").append(g.facebox.html());if(!g.facebox.settings.noAutoload){a()}g("#facebox .close").click(g.facebox.close)}function a(){g("#facebox").find(".b:first, .loading, .close , .bl, .br, .tl, .tr").each(function(){var m=new Image();m.src=g(this).css("background-image").replace(/url\((.+)\)/,"$1")})}function i(){var n,m;if(self.pageYOffset){m=self.pageYOffset;n=self.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){m=document.documentElement.scrollTop;n=document.documentElement.scrollLeft}else{if(document.body){m=document.body.scrollTop;n=document.body.scrollLeft}}}return new Array(n,m)}function j(){var m;if(self.innerHeight){m=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){m=document.documentElement.clientHeight}else{if(document.body){m=document.body.clientHeight}}}return m}function e(){var m=g.facebox.settings;m.imageTypes=m.image_types||m.imageTypes;m.faceboxHtml=m.facebox_html||m.faceboxHtml}function k(n,m){if(n.match(/#/)){var o=window.location.href.split("#")[0];var p=n.replace(o,"");g.facebox.reveal(g(p).show().replaceWith("<div id='facebox_moved'></div>"),m)}else{if(n.match(g.facebox.settings.imageTypesRegexp)){d(n,m)}else{h(n,m)}}}function d(n,m){var o=new Image();o.onload=function(){g.facebox.reveal('<div class="image"><img src="'+o.src+'" /></div>',m)};o.src=n}function h(n,m){g.get(n,function(o){g.facebox.reveal(o,m)})}function c(){return g.facebox.settings.overlay==false||g.facebox.settings.opacity===null}function f(){if(c()){return}if(g("#facebox_overlay").length==0){g("body").append('<div id="facebox_overlay" class="facebox_hide"></div>')}g("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity",g.facebox.settings.opacity).click(function(){g(document).trigger("close.facebox")}).fadeIn(200);return false}function b(){if(c()){return}g("#facebox_overlay").fadeOut(200,function(){g("#facebox_overlay").removeClass("facebox_overlayBG").addClass("facebox_hide").remove()});return false}g(document).bind("close.facebox",function(){g(document).unbind("keydown.facebox");g("#facebox").fadeOut(function(){if(g("#facebox_moved").length==0){g("#facebox .content").removeClass().addClass("content")}else{g("#facebox_moved").replaceWith(g("#facebox .content").children().hide())}b();g("#facebox .loading").remove()});g(document).trigger("afterClose.facebox")})})(jQuery);